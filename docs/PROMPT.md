# Prompt engineering guide
**References**: 
- https://www.promptingguide.ai/kr
- https://help.openai.com/en/articles/6654000-best-practices-for-prompt-engineering-with-openai-api
- https://community.openai.com/

## 목차 ##
- [LLM 설정](#LLM-설정)
- [Prompt 구성 요소](#prompt-구성-요소)
- [Zero-Shot Prompting](#zero-shot-prompting)
- [Few-Shot Prompting](#few-shot-prompting)
- [ Chain-of-Thought Prompting](#생각의-사슬-프롬프팅)

## LLM 설정
**temperature** : 해당 값이 낮을 수록 가장 확률이 높은 토큰이 출력된다. temperature 수치를 증가 할 수록 결과는 다양하고 창조적인 결과를 출력한다. 따라서 factual response만을 원하는 서비스의 경우에는 낮은 temperature를 사용하는 것이 좀 더 사실적이고 간결한 응답을 얻을 수 있다. 

**Top P**: 해당 값을 낮출 수록 사실적이고 정확한 답변을 출력한다 (exact and factual answers). *temperature*와 *Top P* 둘 중에 하나의 값만 설정해서 사용하는 것이 일반적이다.

reference: https://www.promptingguide.ai/introduction/settings

## Prompt 구성 요소
- 지시: 모델에게 수행할 특정 작업 또는 지시 사항 전달
- 문맥: 모델이 더 낳은 답변을 위해 외부의 정보나 추가적인 context를 전달 할 수 있음
- 입력 데이터: 질문
- 출력 지시자: 출력 형식의 지정

아래의 예시는 지시와 문맥 그리고 질문 사항과 원하는 출력 형태를 명확하게 전달하는 프롬프트를 나타낸다.

```plain
다음 텍스트에서 장소의 이름을 추출해 줘.
원하는 형식:
장소: 콤마로 구분해서 표시

입력: "대전찍고 부산찍고 서울갔다 인천 도착해서 밥 먹고 다시 강원도 양양 가서 스키타고 경기도 시흥시에 있는 집으로 도착했다"
```
위의 사례에서 보듯이 입력 사항을 "" 등으로 명확하게 표시하는 것이 더 낳은 엔지니어링 기법이다.
```plain
Summarize the text below as a bullet point list of the most important points.

Text: """
{text input here}
"""
```

## Zero shot prompting
모델에 아무런 예제를 제공하지 않는 것을 제로샷 프롬프팅이라고 한다. 만약 제로샷이 제대로 동작하지 않는 경우에는 프롬프트에 데모나 예시를 제공하여 퓨샷으로 프롬프트를 사용하는 것이 좋다.

## Few shot prompting
퓨샷(few-shot) 프롬프트는 프롬프트에서 데모를 제공하여 모델이 더 나은 성능을 발휘하도록 유도하는 문맥 내 학습을 가능하게 하는 기술이다. 

```plain
정말 멋지네요! // 부정
이건 나쁘다! // 긍정
와우 그 영화 정말 멋졌어요! // 긍정
정말 끔찍한 쇼였어! //
```
```plain
긍정적: 이거 멋지다!
부정적: 이것은 나쁘다!
긍정적: 와우, 그 영화 정말 멋졌어요!
부정적: 정말 끔찍한 쇼였어!
```

하지만, 아래와 같이 복잡한 추론 작업을 처리할 때에는 퓨샷 방식에 한계가 발생한다.
```plain
이 집합 {4, 8, 9, 15, 12, 2, 1}에서 홀수의 합은 짝수입니다.
A: 답은 거짓입니다.

이 집합 {17, 10, 19, 4, 8, 12, 24}에서 홀수의 합은 짝수입니다.
A: 정답은 참입니다.

이 집합 {16, 11, 14, 4, 8, 13, 24}에서 홀수의 합은 짝수입니다.
A: 답은 참입니다.

이 집합 {17, 9, 10, 12, 13, 4, 2}에서 홀수의 합은 짝수입니다.
A: 답은 거짓입니다.

이 집합 {15, 32, 5, 13, 82, 7, 1}에서 홀수의 합은 짝수입니다.
A:
```

```plain
정답은 참입니다.
```
여러번 질문을 하면 정답을 맞추는 경우도 있고 틀린 답을 제시하는 경우도 있다. 즉, 퓨샷 방식에 한계가 있음을 보여준다. 이러한 유형의 추론 문제에 대해 신뢰할 수 있는 답변을 얻으려면 몇 번의 프롬프트만으로는 충분하지 않다. 따라서 최근에는 더 복잡한 산술, 상식, 상징적 추론 작업을 처리하기 위해 CoT 프롬프팅을 사용한다.

## 생각의 사슬 프롬프팅
CoT 프롬프트는 중간 추론 단계를 통해 복잡한 추론을 가능하게 한다.
```plain
집합 {4, 8, 9, 15, 12, 2, 1}에서 홀수를 모두 더하면 짝수야.
답변: 홀수(9, 15, 1)를 모두 더하면 25가 돼. 위의 명제는 거짓이야.

집합 {17, 10, 19, 4, 8, 12, 24}에서 홀수를 모두 더하면 짝수야.
답변: 홀수(17, 19)를 모두 더하면 36이 돼. 위의 명제는 참이야.

집합 {16, 11, 14, 4, 8, 13, 24}에서 홀수를 모두 더하면 짝수야.
답변: 홀수(11, 13)를 모두 더하면 24가 돼. 위의 명제는 참이야.

집합 {17, 9, 10, 12, 13, 4, 2}에서 홀수를 모두 더하면 짝수야.
답변: 홀수(17, 9, 13)를 모두 더하면 39가 돼. 위의 명제는 거짓이야.

집합 {15, 32, 5, 13, 82, 7, 1}에서 홀수를 모두 더하면 짝수야.
답변:
```

```plain
홀수(15, 5, 13, 7, 1)를 모두 더하면 41이 됩니다. 따라서 위의 명제는 거짓입니다.
```
또한, zero-shot CoT를 통해 단계별로 (step by step) 생각해서 답변해 달라고 요청할 수도 있다. ("let's think step by step" prompt)

```plain
나는 시장에 가서 사과 10개를 샀어. 나는 사과 2개를 이웃에게 주고, 2개를 수리공에게 주었어. 그리고 사과 5개를 더 사서 1개는 내가 먹었어. 사과가 몇 개나 남았니?

단계별로 생각해 보자.
```

```plain
처음에 사과 10개를 샀다.
이웃에게 2개를 주었으므로, 10 - 2 = 8개가 남았다.
수리공에게 2개를 주었으므로, 8 - 2 = 6개가 남았다.
추가로 사과 5개를 더 샀다. 따라서 6 + 5 = 11개가 된다.
마지막으로 1개를 먹었으므로, 11 - 1 = 10개가 남았다.
따라서, 사과는 10개가 남았습니다.
```
GPT가 단계별로 문제를 풀어 나가면서 답변하는 것을 확인할 수 있다.